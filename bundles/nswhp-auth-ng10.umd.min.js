!function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("@angular/core"),require("@angular/common"),require("@angular/common/http"),require("@angular/material/button"),require("@angular/material/card"),require("@angular/material/chips"),require("@angular/material/form-field"),require("@angular/material/icon"),require("@angular/material/input"),require("@angular/material/radio"),require("@angular/router"),require("adal-angular4"),require("jwt-decode"),require("adal-angular4/index"),require("rxjs"),require("rxjs/operators"),require("http-status-codes")):"function"==typeof define&&define.amd?define("nswhp-auth-ng10",["exports","@angular/core","@angular/common","@angular/common/http","@angular/material/button","@angular/material/card","@angular/material/chips","@angular/material/form-field","@angular/material/icon","@angular/material/input","@angular/material/radio","@angular/router","adal-angular4","jwt-decode","adal-angular4/index","rxjs","rxjs/operators","http-status-codes"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self)["nswhp-auth-ng10"]={},t.ng.core,t.ng.common,t.ng.common.http,t.ng.material.button,t.ng.material.card,t.ng.material.chips,t.ng.material.formField,t.ng.material.icon,t.ng.material.input,t.ng.material.radio,t.ng.router,t["adal-angular4"],t.jwt_decode,t.i1,t.rxjs,t.rxjs.operators,t["http-status-codes"])}(this,(function(t,e,n,i,r,o,a,s,c,u,l,d,p,h,g,f,m,v){"use strict";function b(t){if(t&&t.__esModule)return t;var e=Object.create(null);return t&&Object.keys(t).forEach((function(n){if("default"!==n){var i=Object.getOwnPropertyDescriptor(t,n);Object.defineProperty(e,n,i.get?i:{enumerable:!0,get:function(){return t[n]}})}})),e.default=t,Object.freeze(e)}var y=b(h),I=new e.InjectionToken("NSWHP_AUTH_CONFIG"),S=function(t){this.nswhpAuthOptions=t};S.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new S(e.ɵɵinject(I))},token:S,providedIn:"root"}),S.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],S.ctorParameters=function(){return[{type:void 0,decorators:[{type:e.Inject,args:[I]}]}]};var A=[r.MatButtonModule,o.MatCardModule,a.MatChipsModule,s.MatFormFieldModule,c.MatIconModule,u.MatInputModule,l.MatRadioModule],T=function(){};T.decorators=[{type:e.NgModule,args:[{imports:[A],exports:[A]}]}];function w(t,e,n,i){return new(n||(n=Promise))((function(r,o){function a(t){try{c(i.next(t))}catch(t){o(t)}}function s(t){try{c(i.throw(t))}catch(t){o(t)}}function c(t){var e;t.done?r(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(a,s)}c((i=i.apply(t,e||[])).next())}))}function C(t,e){var n,i,r,o,a={label:0,sent:function(){if(1&r[0])throw r[1];return r[1]},trys:[],ops:[]};return o={next:s(0),throw:s(1),return:s(2)},"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function s(o){return function(s){return function(o){if(n)throw new TypeError("Generator is already executing.");for(;a;)try{if(n=1,i&&(r=2&o[0]?i.return:o[0]?i.throw||((r=i.return)&&r.call(i),0):i.next)&&!(r=r.call(i,o[1])).done)return r;switch(i=0,r&&(o=[2&o[0],r.value]),o[0]){case 0:case 1:r=o;break;case 4:return a.label++,{value:o[1],done:!1};case 5:a.label++,i=o[1],o=[0];continue;case 7:o=a.ops.pop(),a.trys.pop();continue;default:if(!(r=a.trys,(r=r.length>0&&r[r.length-1])||6!==o[0]&&2!==o[0])){a=0;continue}if(3===o[0]&&(!r||o[1]>r[0]&&o[1]<r[3])){a.label=o[1];break}if(6===o[0]&&a.label<r[1]){a.label=r[1],r=o;break}if(r&&a.label<r[2]){a.label=r[2],a.ops.push(o);break}r[2]&&a.ops.pop(),a.trys.pop();continue}o=e.call(t,a)}catch(t){o=[6,t],i=0}finally{n=r=0}if(5&o[0])throw o[1];return{value:o[0]?o[1]:void 0,done:!0}}([o,s])}}}Object.create;Object.create;var O=y,k=function(){function t(){this.TRANSACTION_ID="TRANSACTION_ID",this.VIP_TOKEN="VIP_TOKEN",this.AZURE_INSTANCE="AZURE_INSTANCE",this.LAST_LOCATION="LAST_LOCATION"}return t.prototype.storeVipToken=function(t){localStorage.setItem(this.VIP_TOKEN,t)},t.prototype.retrieveVipToken=function(){return localStorage.getItem(this.VIP_TOKEN)},t.prototype.clearVipToken=function(){localStorage.removeItem(this.VIP_TOKEN)},t.prototype.storeLastLocation=function(){var t=""+window.location.pathname+window.location.search;console.debug("### Storing last location:"),console.debug(window.location),console.debug("### location = "+t),localStorage.setItem(this.LAST_LOCATION,t)},t.prototype.retrieveLastLocation=function(){return console.debug("### Retrieving last location: "+localStorage.getItem(this.LAST_LOCATION)),localStorage.getItem(this.LAST_LOCATION)},t.prototype.clearLastLocation=function(){console.debug("### Clearing the last location"),localStorage.removeItem(this.LAST_LOCATION)},t.prototype.storeTransactionId=function(t){localStorage.setItem(this.TRANSACTION_ID,t)},t.prototype.retrieveTransactionId=function(){return localStorage.getItem(this.TRANSACTION_ID)},t.prototype.clearTransactionId=function(){localStorage.removeItem(this.TRANSACTION_ID)},t.prototype.storeAzureInstance=function(t){localStorage.setItem(this.AZURE_INSTANCE,t.toString())},t.prototype.retrieveAzureInstance=function(){return parseInt(localStorage.getItem(this.AZURE_INSTANCE),10)},t.prototype.retrieveAzureTenantId=function(){var t=localStorage.getItem("adal.idtoken");return t?O(t).tid:null},t.prototype.clearAzureInstance=function(){localStorage.removeItem(this.AZURE_INSTANCE)},t}();k.decorators=[{type:e.Injectable}],k.ctorParameters=function(){return[]};var R=function(){function t(t,e,n){this.adalService=t,this.storage=e,this.nswhpAuthService=n,this.adalConfigs=this.nswhpAuthService.nswhpAuthOptions.adalConfig}return t.prototype.isValidAdalConfigIndex=function(t){return null!==t&&t>=0&&t<this.adalConfigs.length},t.prototype.initialiseAdalServiceWithConfig=function(t){if(!this.isValidAdalConfigIndex(t))throw new Error("ConfigIndex out of bounds. Consider checking with the isValidAdalConfigIndex helper method before calling.");console.debug("Initialising adal4Service with config index: "+t);var e=this.adalConfigs[t];console.debug("Adal config: "),console.debug("- tenant: "+e.tenant),console.debug("- clientId: "+e.clientId),this.adalService.init(this.adalConfigs[t]),console.debug(">>>>>>> Actual config after init:"),console.debug(this.adalService.config)},t.prototype.getConfigIndexByTenant=function(t){if(t===this.adalConfigs[0].tenant)return 0;throw Error("Unknown tenant passed in: "+t)},t.prototype.handleWindowCallbackFromAzureLogin=function(){this.adalService.handleWindowCallback()},t.prototype.loginToAzure=function(){this.storage.clearVipToken(),this.storage.clearTransactionId(),this.adalService.login()},t.prototype.logoutOfAzure=function(){this.storage.clearAzureInstance(),this.adalService.logOut()},t.prototype.retrieveAadToken=function(){return this.adalService.userInfo.token},t}();R.AZURE_AD_INSTANCE=0,R.AZURE_B2C_INSTANCE=1,R.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new R(e.ɵɵinject(g.AdalService),e.ɵɵinject(k),e.ɵɵinject(S))},token:R,providedIn:"root"}),R.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],R.ctorParameters=function(){return[{type:p.AdalService},{type:k},{type:S}]};var E=function(){function t(t,e,n,i){this.aadService=t,this.router=e,this.activatedRoute=n,this.storage=i,this.azureInstanceAD="NSW Health Employee"}return t.prototype.handleLoginRouting=function(){return w(this,void 0,void 0,(function(){var t,e;return C(this,(function(n){switch(n.label){case 0:return(t=this.activatedRoute.snapshot.params.tenantConfigId)?(this.aadService.initialiseAdalServiceWithConfig(t),this.aadService.handleWindowCallbackFromAzureLogin(),e=this.storage.retrieveLastLocation(),this.storage.clearLastLocation(),e?(window.location.href=e,[3,3]):[3,1]):[3,4];case 1:return[4,this.router.navigate([""])];case 2:n.sent(),n.label=3;case 3:return[3,5];case 4:this.selectAzureInstance(this.azureInstanceAD),n.label=5;case 5:return[2]}}))}))},t.prototype.ngOnInit=function(){return w(this,void 0,void 0,(function(){return C(this,(function(t){switch(t.label){case 0:return console.debug("LOGIN onInit"),[4,this.handleLoginRouting()];case 1:return t.sent(),[2]}}))}))},t.prototype.selectAzureInstance=function(t){console.debug("Selecting Azure instance: "+t),t===this.azureInstanceAD&&this.aadService.initialiseAdalServiceWithConfig(R.AZURE_AD_INSTANCE),this.aadService.loginToAzure()},t}();E.decorators=[{type:e.Component,args:[{selector:"lib-azure-login",template:'<section class="mat-elevation-z2 form-container">\r\n  <button color="accent" mat-raised-button class="big" (click)="selectAzureInstance(azureInstanceAD)">\r\n    {{azureInstanceAD}}\r\n  </button>\r\n</section>\r\n',styles:[".big{font-size:20px;margin:50px}",".form-container{background-color:#fff;font-weight:700;margin-bottom:12px;margin-left:5px;margin-top:12px;padding:15px}"]}]}],E.ctorParameters=function(){return[{type:R},{type:d.Router},{type:d.ActivatedRoute},{type:k}]};var P=function(){function t(t){this.aadService=t}return t.prototype.ngOnInit=function(){this.aadService.logoutOfAzure()},t}();P.decorators=[{type:e.Component,args:[{template:"",selector:"lib-azure-logout"}]}],P.ctorParameters=function(){return[{type:R}]};var x=function(){function t(t){this.router=t,this.email="NSWPATH-TestCatalogue@health.nsw.gov.au",this.subject="Requesting Access to the Statewide Test Catalogue",this.href="mailto:"+this.email+"?subject="+this.subject}return t.prototype.redirect=function(){return w(this,void 0,void 0,(function(){return C(this,(function(t){switch(t.label){case 0:return[4,this.router.navigate(["authentication/login"])];case 1:return t.sent(),[2]}}))}))},t}();x.decorators=[{type:e.Component,args:[{selector:"lib-contact-admin",template:'<div class="container h-50">\r\n  <div class="row align-items-center h-100">\r\n    <div class="col-10 mx-auto">\r\n      <div class="jumbotron">\r\n        <h1 class="display-4">Access Denied</h1>\r\n        <hr class="my-4">\r\n        <p class="lead">\r\n          Unfortunately, If you have reached this page after logging in, it means you do not have the required\r\n          permissions to proceed. Please contact us at (<a rel="noopener noreferrer" href="{{href}}">{{email}}</a>) to\r\n          request access. We apologize for any inconvenience.\r\n        </p>\r\n        <button mat-raised-button color="primary" (click)="redirect()">Return to login</button>\r\n      </div>\r\n    </div>\r\n  </div>\r\n</div>\r\n',styles:["",".form-container{background-color:#fff;font-weight:700;margin-bottom:12px;margin-left:5px;margin-top:12px;padding:15px}"]}]}],x.ctorParameters=function(){return[{type:d.Router}]};var N=function(){this.IaDfp=IaDfp};N.decorators=[{type:e.Injectable}],N.ctorParameters=function(){return[]};var M=function(){function t(t,e,n,i,r){this.http=t,this.router=e,this.storage=n,this.iaDfpService=i,this.nswhpAuthService=r,this.pushUrl=this.nswhpAuthService.nswhpAuthOptions.adal.pushUrl,this.otpUrl=this.nswhpAuthService.nswhpAuthOptions.adal.otpUrl,this.sendOtpUrl=this.nswhpAuthService.nswhpAuthOptions.adal.sendOtpUrl,this.registerUrl=this.nswhpAuthService.nswhpAuthOptions.adal.registerUrl}return t.prototype.pollUsersPushResponse=function(){var t=this;console.debug("Authenticating user with PUSH...");var e=JSON.stringify({transactionId:this.storage.retrieveTransactionId()});return console.debug("TRANSACTION ID = "+this.storage.retrieveTransactionId()),this.http.post(this.pushUrl,e).pipe(m.map((function(e){return t.extractData(e)}))).pipe(m.catchError(this.handleError.bind(this)))},t.prototype.authenticateOtpCode=function(t){var e=this;console.debug("Authenticating user with OTP...");var n={deviceFingerprint:this.getDeviceFingerprint(),otp:t};return this.http.post(this.otpUrl,n).pipe(m.map((function(t){return e.extractData(t)}))).pipe(m.catchError(this.handleError.bind(this)))},t.prototype.sendOtpForRegistration=function(){var t=this;console.debug("Creating VIP Account and sending user SMS OTP code...");var e={deviceFingerprint:this.getDeviceFingerprint()};return this.http.post(this.sendOtpUrl,e).pipe(m.map((function(e){return t.extractData(e)}))).pipe(m.catchError(this.handleError.bind(this)))},t.prototype.submitVipRegistration=function(t,e,n,i){var r=this;console.debug("Submitting user's VIP registration...");var o=this.getDeviceFingerprint(),a={deviceFingerprint:o,credentialId:t,otp1:e,otp2:n,tempOtp:i};return console.debug("Device fingerprint: "+o),console.debug("Credential ID: "+t),console.debug("First security code: "+e),console.debug("Second security code: "+n),console.debug("SMS Code: "+i),this.http.post(this.registerUrl,a).pipe(m.tap((function(t){return r.extractData(t)}),m.catchError(this.handleError.bind(this))))},t.prototype.redirectToLastLocation=function(){console.debug("### VIP SERVICE: redirectToLastLocation");var t=this.storage.retrieveLastLocation();this.storage.clearLastLocation(),t?(console.debug("### We HAVE just returned from handling a 401 error. Redirecting to... "+t),this.storage.clearLastLocation(),window.location.href=t):console.debug("### We have NOT returned from handling a 401 error")},t.prototype.getDeviceFingerprint=function(){return this.iaDfpService.IaDfp.readFingerprint()},t.prototype.extractData=function(t){return console.debug(">>> VIP SERVICE: "),console.debug(t),t.vipToken&&this.storage.storeVipToken(t.vipToken),t},t.prototype.handleError=function(t){return w(this,void 0,void 0,(function(){return C(this,(function(e){switch(e.label){case 0:return 403!==t.status?[3,2]:[4,this.handleContactAdmin(t)];case 1:return e.sent(),[2,f.EMPTY];case 2:return[2,f.throwError(t)]}}))}))},t.prototype.handleContactAdmin=function(t){return w(this,void 0,void 0,(function(){return C(this,(function(e){switch(e.label){case 0:return console.debug("Handling Operation Not Allowed"),console.debug("User is unable to continue authorization process."),console.debug(t.error.detailMessage),console.debug("Redirecting user to contact admin page..."),[4,this.router.navigate(["/authentication/contact-admin/"+t.error.requestId])];case 1:return e.sent(),[2]}}))}))},t}();M.decorators=[{type:e.Injectable}],M.ctorParameters=function(){return[{type:i.HttpClient},{type:d.Router},{type:k},{type:N},{type:S}]};var D=function(){function t(t){this.vipService=t,this.submitted=!1,this.authenticated=!1,this.failed=!1,this.submitButtonText="Submit"}return t.prototype.ngOnInit=function(){},t.prototype.onSubmit=function(t){var e=this;return this.submitted||(this.submitted=!0,this.submitButtonText="Submitting...",this.vipService.authenticateOtpCode(t).subscribe((function(t){e.handleSuccessfulOtpAuthentication(t)}),(function(){e.handleFailedOtpAuthentication()}))),!1},t.prototype.handleSuccessfulOtpAuthentication=function(t){console.debug(t),this.authenticated=!0,this.failed=!1,this.vipService.redirectToLastLocation()},t.prototype.handleFailedOtpAuthentication=function(){this.submitted=!1,this.failed=!0,this.submitButtonText="Try Again"},t.prototype.enteringOtp=function(){this.failed=!1},t}();D.decorators=[{type:e.Component,args:[{selector:"lib-otp",template:'<section class="mat-elevation-z2 form-container">\r\n  <div *ngIf="!authenticated">\r\n    <h2>Please enter your Security Code below and press Submit</h2>\r\n    <h3>You can find your Security Code in your VIP Access mobile app or desktop app</h3>\r\n    <p *ngIf="failed" class="invalid-input-message">Failed to authenticate OTP, please try again.</p>\r\n    <form (submit)="onSubmit(otpCode.value)">\r\n      <div class="container-body">\r\n        <mat-form-field class="search-form-field">\r\n          <input #otpCode matFormFieldControl matInput type="text" placeholder="SECURITY CODE" required\r\n            [ngClass]="{ \'invalid-input\' : failed }" (keypress)="enteringOtp()" />\r\n\r\n        </mat-form-field>\r\n\r\n        <div class="container-button">\r\n          <button mat-button matSuffix color="accent" mat-raised-button id="submit" type="submit">\r\n            {{submitButtonText}}\r\n          </button>\r\n        </div>\r\n      </div>\r\n    </form>\r\n  </div>\r\n  <div *ngIf="authenticated">\r\n    <h1>Success!</h1>\r\n    <lib-tick></lib-tick>\r\n  </div>\r\n</section>\r\n',styles:["",".form-container{background-color:#fff;font-weight:700;margin-bottom:12px;margin-left:5px;margin-top:12px;padding:15px}"]}]}],D.ctorParameters=function(){return[{type:M}]};var _=function(){function t(t,e){this.router=t,this.vipService=e,this.statusMessage="",this.detailMessage=""}return t.prototype.ngOnInit=function(){var t=this;this.waiting=!0,this.vipService.pollUsersPushResponse().subscribe((function(e){t.handleSuccessfulPush(e)}),(function(e){t.handleFailedPush(e)}))},t.prototype.handleSuccessfulPush=function(t){console.debug("SUCCESS: User accepted push notification"),console.debug("vipToken: "+t.vipToken),console.debug(t),this.waiting=!1,this.success=!0,this.statusMessage=t.statusMessage,this.detailMessage=t.detailMessage,this.vipService.redirectToLastLocation()},t.prototype.handleFailedPush=function(t){console.debug("ERROR: Did not receive user's push acceptance"),console.error(t),console.error(t.error),this.waiting=!1,this.success=!1;var e=t.error;this.statusMessage=e.statusMessage,this.detailMessage=e.detailMessage},t.prototype.useOTP=function(){return w(this,void 0,void 0,(function(){return C(this,(function(t){switch(t.label){case 0:return console.debug("User has selected to use OTP instead of Push. Redirecting..."),[4,this.router.navigate(["authentication/otp"])];case 1:return t.sent(),[2]}}))}))},t}();_.decorators=[{type:e.Component,args:[{selector:"lib-push",template:'<section class="mat-elevation-z2 form-container">\r\n  <div *ngIf="waiting">\r\n    <h2>A push notification has been sent to your mobile device.</h2>\r\n    <h3>Waiting for Sign in Request to be approved...</h3>\r\n    <lib-spinner [isRunning]="waiting"></lib-spinner>\r\n    <h3>Please do not refresh this page</h3>\r\n    <button mat-button mat-raised-button color="primary" (click)="useOTP()">Use OTP Instead</button>\r\n  </div>\r\n  <div *ngIf="!waiting">\r\n    <h1>{{statusMessage}}</h1>\r\n    <h2>{{detailMessage}}</h2>\r\n    <div *ngIf="success">\r\n      <lib-tick></lib-tick>\r\n    </div>\r\n    <div *ngIf="!success">\r\n      <button mat-button mat-raised-button color="primary" (click)="useOTP()">Use OTP Instead</button>\r\n    </div>\r\n  </div>\r\n</section>\r\n',styles:["",".form-container{background-color:#fff;font-weight:700;margin-bottom:12px;margin-left:5px;margin-top:12px;padding:15px}"]}]}],_.ctorParameters=function(){return[{type:d.Router},{type:M}]};var U=function(){function t(t,e){this.router=t,this.vipService=e,this.smsCodeSent=!1,this.registered=!1,this.failed=!1,this.statusMessage="",this.submitButtonText="Register",this.mobileNumber="",this.invalidInputMessage="",this.credentialIdValue="",this.otp1Value="",this.otp2Value="",this.tempOtpValue="",this.validInputs=[!0,!0,!0,!0],this.CREDENTIAL_ID=0,this.OTP_1=1,this.OTP_2=2,this.TEMP_OTP=3}return t.prototype.ngOnInit=function(){this.initiateRegistrationProcess()},t.prototype.initiateRegistrationProcess=function(){var t=this;this.smsCodeSent=!1,this.validInputs=[!0,!0,!0,!0],this.vipService.sendOtpForRegistration().subscribe((function(e){console.debug(e),t.smsCodeSent=!0,t.mobileNumber=e.mobileNumber}),(function(e){return w(t,void 0,void 0,(function(){return C(this,(function(t){switch(t.label){case 0:return console.debug("Error sending SMS code to user for registration..."),console.debug(e),[4,this.router.navigate(["/authentication/contact-admin"])];case 1:return t.sent(),[2]}}))}))}))},t.prototype.onSubmit=function(t,e,n,i){var r=this;return this.allInputsValid(t,e,n,i)&&(this.submitButtonText="Registering...",this.vipService.submitVipRegistration(t,e,n,i).subscribe((function(t){r.handleSuccessfulRegistration(t)}),(function(t){r.handleFailedRegistration(t)}))),!1},t.prototype.handleSuccessfulRegistration=function(t){console.debug("SUCCESS: User registered with VIP"),console.debug("vipToken: "+t.vipToken),console.debug(t),this.registered=!0,this.failed=!1,this.statusMessage=t.statusMessage,this.vipService.redirectToLastLocation()},t.prototype.handleFailedRegistration=function(t){console.debug("ERROR: Failed to register user with VIP"),console.debug(t),this.failed=!0,this.credentialIdValue=null,this.otp1Value=null,this.otp2Value=null,this.tempOtpValue=null,this.submitButtonText="Try Again",this.initiateRegistrationProcess()},t.prototype.validateInput=function(t){if(console.debug(t),this.validInputs[parseInt(t.id,10)]=!0,this.invalidInputMessage="",/\s/.test(t.value)&&(this.validInputs[parseInt(t.id,10)]=!1,this.invalidInputMessage="Input must not contain spaces"),t.id===this.OTP_1.toString()||t.id===this.OTP_2.toString()||t.id===this.TEMP_OTP.toString()){t.value.match(/^[0-9]*$/)||(this.validInputs[parseInt(t.id,10)]=!1,this.invalidInputMessage="Codes may only contains numbers")}console.debug(this.validInputs)},t.prototype.allInputsValid=function(t,e,n,i){return i.length<=0&&(this.validInputs[this.TEMP_OTP]=!1),n.length<=0&&(this.validInputs[this.OTP_2]=!1),e.length<=0&&(this.validInputs[this.OTP_1]=!1),t.length<=0&&(this.validInputs[this.CREDENTIAL_ID]=!1),this.validInputs.includes(!1)?(this.invalidInputMessage="Please fill in all fields",!1):(this.invalidInputMessage="",!0)},t}();U.decorators=[{type:e.Component,args:[{selector:"lib-register",template:'<section class="mat-elevation-z2 form-container">\r\n  <h3 *ngIf="failed">Failed Registration.<br>We have sent you a new SMS code. Please try again.</h3>\r\n\r\n  <div [ngClass]="{ \'hidden\' : registered }">\r\n    <p class="invalid-input-message">{{invalidInputMessage}}</p>\r\n\r\n    <form autocomplete="off" (submit)="onSubmit(credentialId.value, otp1.value, otp2.value, tempOtp.value)">\r\n      <p>Download Symantec VIP Access for desktop or mobile\r\n        <a href="https://vip.symantec.com/" target="_blank" rel="external nofollow noopener">here.</a>\r\n      </p>\r\n\r\n      <mat-form-field>\r\n        <input #credentialId matInput [value]="credentialIdValue" name="credentialId" type="text" required\r\n          placeholder="Enter VIP Credential ID" [ngClass]="{ \'invalid-input\' : !validInputs[0] }" id="0"\r\n          (change)="validateInput(credentialId)">\r\n      </mat-form-field>\r\n\r\n      <p>Please enter two <u>sequential</u> security codes</p>\r\n      <mat-form-field>\r\n        <input #otp1 matInput required [value]="otp1Value" type="text" placeholder="FIRST SECURITY CODE"\r\n          [ngClass]="{ \'invalid-input\' : !validInputs[1] }" id="1" (change)="validateInput(otp1)">\r\n      </mat-form-field>\r\n\r\n      <mat-form-field>\r\n        <input #otp2 matInput required [value]="otp2Value" type="text" placeholder="SECOND SECURITY CODE"\r\n          [ngClass]="{ \'invalid-input\' : !validInputs[2] }" id="2" (change)="validateInput(otp2)">\r\n      </mat-form-field>\r\n\r\n      <div *ngIf="!smsCodeSent">\r\n        <p>Sending SMS code to your mobile device...</p>\r\n        <mat-chip-list>\r\n          <mat-chip selectable=false>Waiting for SMS code...</mat-chip>\r\n        </mat-chip-list>\r\n      </div>\r\n\r\n      <p *ngIf="smsCodeSent">SMS Code has been sent to +{{mobileNumber}}</p>\r\n      <mat-form-field>\r\n        <input #tempOtp matInput required [value]="tempOtpValue" type="text" placeholder="SMS CODE"\r\n          [ngClass]="{ \'invalid-input\' : !validInputs[3], \'hidden\' : !smsCodeSent }" id="3"\r\n          (change)="validateInput(tempOtp)">\r\n      </mat-form-field>\r\n\r\n      <button mat-button mat-raised-button color="primary" id="submit" type="submit"\r\n        [ngClass]="{ \'hidden\' : !smsCodeSent }">{{submitButtonText}}</button>\r\n    </form>\r\n  </div>\r\n\r\n  <div [ngClass]="{ \'hidden\' : !registered }">\r\n    <h3>{{statusMessage}}</h3>\r\n    <lib-tick></lib-tick>\r\n  </div>\r\n</section>\r\n',styles:["form{display:flex;flex-direction:column}",".form-container{background-color:#fff;font-weight:700;margin-bottom:12px;margin-left:5px;margin-top:12px;padding:15px}"]}]}],U.ctorParameters=function(){return[{type:d.Router},{type:M}]};var L=function(){function t(t,e,n,i,r,o){this.aadService=t,this.storageService=e,this.router=n,this.http=i,this.iaDfpService=r,this.nswhpAuthService=o,this.AAD_TOKEN_HEADER="AuthorizationAD",this.VIP_TOKEN_HEADER="AuthorizationVIP",this.domain=this.nswhpAuthService.nswhpAuthOptions.vip.domain,this.stepUpPath=this.nswhpAuthService.nswhpAuthOptions.vip.stepUpPath}return t.prototype.intercept=function(t,e){return t=this.addAuthHeaders(t),e.handle(t).pipe(m.catchError(this.handleError.bind(this)))},t.prototype.addAuthHeaders=function(t){var e={"Content-Type":"application/json","Access-Control-Allow-Origin":"*","Access-Control-Allow-Methods":"POST, GET, OPTIONS, DELETE","Access-Control-Max-Age":"3600","Access-Control-Allow-Headers":"x-requested-with"},n=this.aadService.retrieveAadToken();n&&(e[this.AAD_TOKEN_HEADER]=n);var i=this.storageService.retrieveVipToken();return i&&(e[this.VIP_TOKEN_HEADER]=i),t=t.clone({setHeaders:e})},t.prototype.handleUserAuthorization=function(t){return w(this,void 0,void 0,(function(){return C(this,(function(e){switch(e.label){case 0:return this.storageService.storeLastLocation(),this.isNewAadTokenRequired(t)?[4,this.router.navigate(["authentication/login"])]:[3,2];case 1:return e.sent(),[3,3];case 2:this.getVipToken(),e.label=3;case 3:return[2]}}))}))},t.prototype.handleError=function(t){return w(this,void 0,void 0,(function(){return C(this,(function(e){switch(e.label){case 0:switch(t.status){case v.UNAUTHORIZED:return[3,1];case v.FORBIDDEN:return[3,3]}return[3,5];case 1:return console.debug("401 received, redirecting to login"),[4,this.handleUserAuthorization(t)];case 2:return e.sent(),[3,6];case 3:return console.debug("403 received in AuthenticationInterceptor, redirecting to contact admin"),[4,this.router.navigate(["/authentication/contact-admin"])];case 4:return e.sent(),[2,f.EMPTY];case 5:return[2,f.throwError(t)];case 6:return[2]}}))}))},t.prototype.isNewAadTokenRequired=function(t){var e=!0;return-1!==t.error.message.search(/(vip|VIP)/)&&(e=!1),e},t.prototype.getVipToken=function(){var t=this;console.debug("Requesting new VIP Token..."),this.stepUpAuthentication().subscribe((function(e){return w(t,void 0,void 0,(function(){return C(this,(function(t){switch(t.label){case 0:return this.logStepUpResponse(e),[4,this.handleStepUpAuthentication(e)];case 1:return t.sent(),[2]}}))}))}),(function(e){return w(t,void 0,void 0,(function(){return C(this,(function(t){switch(t.label){case 0:return e.status!==v.FORBIDDEN?[3,2]:(console.error("403 received"),[4,this.handleContactAdmin(e)]);case 1:return t.sent(),[2,f.EMPTY];case 2:return e.status!==v.NOT_FOUND?[3,4]:(console.error("404 received"),[4,this.handleRegistration(e)]);case 3:return t.sent(),[2,f.EMPTY];case 4:return[4,this.handleError(e)];case 5:t.sent(),t.label=6;case 6:return[2]}}))}))}))},t.prototype.stepUpAuthentication=function(){console.debug("User required to step up authentication: ");var t=this.aadService.retrieveAadToken(),e={headers:(new i.HttpHeaders).set(this.AAD_TOKEN_HEADER,t),observe:"response"},n={deviceFingerprint:this.iaDfpService.IaDfp.readFingerprint()},r=JSON.stringify(n),o=this.domain+this.stepUpPath;return console.debug("Sending request: "),console.debug("- url: "+o),console.debug("- authorization: "+t),console.debug("- body: "+r),this.http.post(o,r,e)},t.prototype.handleStepUpAuthentication=function(t){return w(this,void 0,void 0,(function(){var e;return C(this,(function(n){switch(n.label){case 0:return e=t.body,console.debug(t),console.debug(e),this.storageService.storeTransactionId(e.transactionId),e.risky?(console.debug("User is required to use Multi-Factor Authentication"),console.debug("Redirecting user to "+e.medium+" page..."),[4,this.router.navigate(["/authentication/"+e.medium.toString().toLowerCase()])]):[3,2];case 1:return n.sent(),[3,3];case 2:this.storageService.storeVipToken(e.vipToken),location.reload(),n.label=3;case 3:return[2]}}))}))},t.prototype.logStepUpResponse=function(t){console.debug(t),console.debug("'risky': "+t.body.risky),console.debug("'requestId': "+t.body.requestId),console.debug("'medium': "+t.body.medium),console.debug("'transactionId': "+t.body.transactionId),console.debug("'vipToken': "+t.body.vipToken)},t.prototype.handleContactAdmin=function(t){return w(this,void 0,void 0,(function(){var e;return C(this,(function(n){switch(n.label){case 0:return e=t,console.debug("Handling Operation Not Allowed"),console.debug("User is unable to continue authorization process."),console.debug(e.error),console.debug("Redirecting user to contact admin page..."),[4,this.router.navigate(["/authentication/contact-admin /"+e.requestId])];case 1:return n.sent(),[2]}}))}))},t.prototype.handleRegistration=function(t){return w(this,void 0,void 0,(function(){var e;return C(this,(function(n){switch(n.label){case 0:return e=t,console.debug("Handling Registration"),console.debug("User has not yet registered with VIP"),console.debug(e.error),console.debug("Redirecting user to registration page..."),[4,this.router.navigate(["/authentication/register"])];case 1:return n.sent(),[2]}}))}))},t}();L.ɵprov=e.ɵɵdefineInjectable({factory:function(){return new L(e.ɵɵinject(R),e.ɵɵinject(k),e.ɵɵinject(d.Router),e.ɵɵinject(i.HttpClient),e.ɵɵinject(N),e.ɵɵinject(S))},token:L,providedIn:"root"}),L.decorators=[{type:e.Injectable,args:[{providedIn:"root"}]}],L.ctorParameters=function(){return[{type:R},{type:k},{type:d.Router},{type:i.HttpClient},{type:N},{type:S}]};var V=function(){function t(){this.isDelayedRunning=!1}return Object.defineProperty(t.prototype,"isRunning",{set:function(t){this.isDelayedRunning=t},enumerable:!1,configurable:!0}),t}();V.decorators=[{type:e.Component,args:[{selector:"lib-spinner",template:'<div [hidden]="!isDelayedRunning" class="spinner">\r\n  <div class="double-bounce1"></div>\r\n  <div class="double-bounce2"></div>\r\n</div>\r\n',styles:[".spinner{height:250px;margin:50px auto;position:relative;width:250px}.double-bounce1,.double-bounce2{animation:sk-bounce 2s ease-in-out infinite;background-color:rgba(155,255,177,.5);border-radius:50%;height:100%;left:0;opacity:.6;position:absolute;top:0;width:100%}.double-bounce2{animation-delay:-1s}@keyframes sk-bounce{0%,to{-webkit-transform:scale(0);transform:scale(0)}50%{-webkit-transform:scale(1);transform:scale(1)}}"]}]}],V.ctorParameters=function(){return[]},V.propDecorators={isRunning:[{type:e.Input}]};var j=function(){function t(){}return t.prototype.ngOnInit=function(){},t}();j.decorators=[{type:e.Component,args:[{selector:"lib-tick",template:'<div class="checkmark">\r\n  <svg version="1.1" id="Layer_1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px"\r\n    y="0px" viewBox="0 0 161.2 161.2" enable-background="new 0 0 161.2 161.2" xml:space="preserve">\r\n    <path class="path" fill="none" stroke="#7DB0D5" stroke-miterlimit="10" d="M425.9,52.1L425.9,52.1c-2.2-2.6-6-2.6-8.3-0.1l-42.7,46.2l-14.3-16.4\r\n\tc-2.3-2.7-6.2-2.7-8.6-0.1c-1.9,2.1-2,5.6-0.1,7.7l17.6,20.3c0.2,0.3,0.4,0.6,0.6,0.9c1.8,2,4.4,2.5,6.6,1.4c0.7-0.3,1.4-0.8,2-1.5\r\n\tc0.3-0.3,0.5-0.6,0.7-0.9l46.3-50.1C427.7,57.5,427.7,54.2,425.9,52.1z" />\r\n    <circle class="path" fill="none" stroke="rgba(155, 255, 177, 1)" stroke-width="4" stroke-miterlimit="10" cx="80.6"\r\n      cy="80.6" r="62.1" />\r\n    <polyline class="path" fill="none" stroke="rgba(155, 255, 177, 1)" stroke-width="6" stroke-linecap="round"\r\n      stroke-miterlimit="10" points="113,52.8\r\n\t74.1,108.4 48.2,86.4 " />\r\n\r\n    <circle class="spin" fill="none" stroke="rgba(155, 255, 177, 1)" stroke-width="4" stroke-miterlimit="10"\r\n      stroke-dasharray="12.2175,12.2175" cx="80.6" cy="80.6" r="73.9" />\r\n\r\n  </svg>\r\n',styles:[".checkmark{margin:0 auto;padding-top:40px;width:200px}.path{-webkit-animation:dash 2s ease-in-out;animation:dash 2s ease-in-out;stroke-dasharray:1000;stroke-dashoffset:0}.spin{-webkit-animation:spin 2s;-webkit-transform-origin:50% 50%;animation:spin 2s;transform-origin:50% 50%}@keyframes dash{0%{stroke-dashoffset:1000}to{stroke-dashoffset:0}}@keyframes spin{0%{-webkit-transform:rotate(0deg)}to{-webkit-transform:rotate(1turn)}}@keyframes text{0%{opacity:0}to{opacity:1}}"]}]}],j.ctorParameters=function(){return[]};var z=function(){function t(){}return t.forRoot=function(e){return{ngModule:t,providers:[{provide:I,useValue:e}]}},t}();z.decorators=[{type:e.NgModule,args:[{declarations:[E,P,D,_,U,V,j,x],exports:[E,P,D,_,U,V,j,x],imports:[n.CommonModule,T],providers:[k,N,T,{provide:i.HTTP_INTERCEPTORS,useClass:L,multi:!0},R,M,p.AdalService],entryComponents:[E,P,D,_,U,V,j,x]}]}];var q=[{path:"authentication/otp",component:D},{path:"authentication/login",component:E},{path:"authentication/login/:tenantConfigId",component:E},{path:"authentication/logout",component:P},{path:"authentication/register",component:U},{path:"authentication/push",component:_},{path:"authentication/contact-admin",component:x}],F=d.RouterModule.forRoot(q),H=function(){};H.decorators=[{type:e.NgModule,args:[{imports:[F],exports:[d.RouterModule]}]}],t.AzureLoginComponent=E,t.AzureLogoutComponent=P,t.ContactAdminComponent=x,t.NswhpAuthModule=z,t.NswhpAuthRoutingModule=H,t.NswhpAuthService=S,t.OtpComponent=D,t.PushComponent=_,t.RegisterComponent=U,t.SpinnerComponent=V,t.TickComponent=j,t.routerModuleForRoot=F,t.ɵb=I,t.ɵc=E,t.ɵd=R,t.ɵe=k,t.ɵf=P,t.ɵg=D,t.ɵh=M,t.ɵi=N,t.ɵj=_,t.ɵk=U,t.ɵl=V,t.ɵm=j,t.ɵn=x,t.ɵo=T,t.ɵp=L,Object.defineProperty(t,"__esModule",{value:!0})}));
//# sourceMappingURL=nswhp-auth-ng10.umd.min.js.map